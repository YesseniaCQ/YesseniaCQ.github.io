---
title: 毕设记录
banner:
  type: video
  bgurl: https://cdn.jsdelivr.net/gh/YesseniaCQ/img/video/心壑/心壑.m3u8
  bannerText: I'm stay with you.
date: 2024-01-02 13:14:40
tags:
cover:
---

```shell
library(Seurat)
load("../20231222_singleMuti/shareData/testis_combined.annotationCellType.Rdata")
Idents(scrnat)<-"cell_type" #修改active.ident
table(Idents(scrnat))

celltype<-levels(scrnat)
celltype=as.data.frame(celltype)
colnames(celltype)<-c("name")

library(ggplot2) 
library(RColorBrewer) #配色
library(patchwork) #拼图
library(magrittr) #管道符
colorCount <- length(unique(celltype$name))
celltype$name <- factor(celltype$name)
p2 <- celltype %>%
    ggplot(aes(x = name, y = 1, color = factor(name))) +
    geom_point(size = 9, show.legend = F) +
    scale_color_manual(values = colorRampPalette(brewer.pal(8, "Set2"))(colorCount)) +
    scale_y_continuous(expand = c(0,0)) +
    scale_x_discrete(limits = unique(celltype$name)) +
    theme(legend.position = "none",
       panel.spacing = unit(0, "lines"),
       panel.background = element_blank(),
       panel.border = element_blank(),
       plot.background = element_blank(),
       plot.margin = margin(0, 0, 0, 0, "pt"),
       axis.text.x = element_text(angle = 90,
                                  size = 12,
                                  hjust = 1,
                                  vjust = 0.5,
                                  color = "black"),
       axis.title  = element_blank(),
       axis.ticks = element_blank(),
       panel.grid = element_blank(),
       axis.text.y = element_blank())

count_mat <- GetAssayData(object=scrnat, layer="counts")
scrnat2 <- AverageExpression(count_mat, scrnat$cell_type, feature_normalize=TRUE, min_pct=0)
pctExpr <- AverageExpression(object = scrnat)
scrnat2=AverageExpression(object = scrnat,return.seurat = TRUE, add.ident = "replicate")


scrnat <- AddMetaData(object = scrnat,
                    metadata = scrnat2,
                    col.name = "pctExpr")
markers = c('UTF1',
			'KIT',
			'STRA8', 
			'SPO11',
			'SYCP3',
			'OVOL2', 
            'NME8',
            'TXNDC8',
            'TNP1','PRM1',
            'AMH',
            'DLK1',
            'MYH11',
            'NOTCH3',
            'CD14',
            'VWF', 
            'NKG7','FGFBP2')
library(stringr)  
p4 <- DotPlot(scrnat2, features=markers,
             assay='RNA') + coord_flip() + RotatedAxis() + 
             theme(axis.text.x=element_text(size=0))


p4/p2+plot_layout(height=c(9,0.5))
ggsave("check_marker_by_seurat_cluster.pdf",width=15,height=10)

```